{"version":3,"sources":["webpack:///./src/views/category/Category.vue?ba9f","webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?9df4"],"names":["id","class","default","active","tabClick","animated","title","activeKey","activeName","accordion","categories","slice","item","key","name","children","sub","getGoods","showGoods","itemClick","num","comments_count","tag","price","desc","updated_at","thumb","cover_url","lazy-load","bTop","isShowBackTop","getCategory","request","url","getCategoryGoods","order","cid","page","use","setup","router","currentOrder","currentCid","goods","sales","list","value","init","then","res","data","bscroll","document","querySelector","probeType","click","pullUpLoad","on","position","y","console","log","push","finishPullUp","refresh","clientHeight","index","orders","scrollTo","path","query","components","NavBar","BackTop","render","__scopeId"],"mappings":"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","file":"js/chunk-c86b6844.ef044ab9.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=0&id=664c20eb&scoped=true&lang=scss\"","<template>\r\n    <div>\r\n        <nav-bar>\r\n            <template v-slot:default>商品分类</template>\r\n        </nav-bar>\r\n\r\n        <div id=\"mainbox\">\r\n            <div class=\"ordertab\">\r\n                <van-tabs v-model=\"active\" @click=\"tabClick\" animated>\r\n                    <van-tab title=\"销量排序\"></van-tab>\r\n                    <van-tab title=\"价格排序\"></van-tab>\r\n                    <van-tab title=\"评论排序\"></van-tab>\r\n                </van-tabs>\r\n            </div>\r\n\r\n            <van-sidebar class=\"leftmenu\" v-model=\"activeKey\">\r\n                <van-collapse v-model=\"activeName\" accordion>\r\n                    <van-collapse-item \r\n                        v-for=\"item in categories.slice(0, 9)\" \r\n                        :key=\"item.id\" \r\n                        :title=\"item.name\" \r\n                        :name=\"item.name\">\r\n                        \r\n                        <van-sidebar-item \r\n                            v-for=\"sub in item.children\" \r\n                            :key=\"sub.id\" \r\n                            :title=\"sub.name\" \r\n                            @click=\"getGoods(sub.id)\"/>\r\n                    </van-collapse-item>\r\n                </van-collapse>\r\n            </van-sidebar>\r\n\r\n            <div class=\"goodslist\">\r\n                <div class=\"content\">\r\n                    <van-card\r\n                        @click=\"itemClick(item.id)\"\r\n                        v-for=\"item in showGoods\"\r\n                        :key=\"item.id\"\r\n                        :num=\"item.comments_count\"\r\n                        :tag=\"item.comments_count >= 0 ? '流行' : ''\"\r\n                        :price=\"item.price\"\r\n                        :desc=\"item.updated_at\"\r\n                        :title=\"item.title\"\r\n                        :thumb=\"item.cover_url\"\r\n                        :lazy-load=\"true\"\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <back-top @bTop=\"bTop\" v-show=\"isShowBackTop\"></back-top>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport NavBar from 'components/common/navbar/NavBar.vue';\r\nimport BackTop from \"components/common/backtop/BackTop\";\r\nimport { ref, reactive, onMounted, computed, watchEffect, nextTick } from 'vue'\r\nimport { getCategory, getCategoryGoods } from 'network/category'\r\nimport BScroll from '@better-scroll/core'\r\nimport Pullup from '@better-scroll/pull-up'\r\nimport { useRouter } from 'vue-router';\r\nBScroll.use(Pullup)\r\n\r\nexport default {\r\n    name: 'Category',\r\n    setup() {\r\n        const router = useRouter();\r\n\r\n        let active     = ref(1)\r\n        let activeKey  = ref(0);\r\n        let activeName = ref(1);\r\n        let categories = ref([]);\r\n        let isShowBackTop = ref(false);\r\n\r\n        // 当前的排序条件\r\n        let currentOrder = ref('sales');\r\n        // 当前的分类ID\r\n        let currentCid = ref(0);\r\n\r\n        //数据模型\r\n        const goods = reactive({\r\n            sales:{page:0, list:[]},\r\n            price:{page:0, list:[]},\r\n            comments_count:{page:0, list:[]}\r\n        })\r\n\r\n        // 计算属性绑定需要显示的数据\r\n        const showGoods = computed(()=>{\r\n            return goods[currentOrder.value].list;\r\n        })\r\n\r\n        const init = () =>{\r\n            getCategoryGoods('sales', currentCid.value).then(res=>{\r\n                goods.sales.list = res.goods.data;\r\n            })\r\n\r\n            getCategoryGoods('price', currentCid.value).then(res=>{\r\n                goods.price.list = res.goods.data;\r\n            })\r\n\r\n            getCategoryGoods('comments_count', currentCid.value).then(res=>{\r\n                goods.comments_count.list = res.goods.data;\r\n            })\r\n        }\r\n\r\n        let bscroll = reactive({});\r\n\r\n        onMounted(() => {\r\n            getCategory().then(res=>{\r\n                // console.log(res);\r\n                categories.value = res.categories;\r\n            })\r\n            init();\r\n\r\n            // 创建BetterScroll对象\r\n            bscroll = new BScroll(document.querySelector('.goodslist'), {\r\n                probeType: 3,    // 0, 1, 2, 3, 3 只要在运运就触发scroll事件\r\n                click: true,     // 是否允许点击\r\n                pullUpLoad: true //上拉加载更多， 默认是false\r\n            });\r\n\r\n            // 注册滚动事件\r\n            bscroll.on('scroll', (position)=>{\r\n                isShowBackTop.value = (-position.y) > 300\r\n            })\r\n\r\n            // 上拉加载数据,触发pullingUp\r\n            bscroll.on(\"pullingUp\", ()=>{\r\n                console.log('上拉加载更多.....');\r\n\r\n                const page = goods[currentOrder.value].page + 1;\r\n                getCategoryGoods(currentOrder.value, currentCid.value, page).then(res=>{\r\n                    goods[currentOrder.value].list.push(...res.goods.data);\r\n                    goods[currentOrder.value].page += 1;\r\n                })\r\n                // 完成上拉，等数据请求完成，要将新数据展示出来\r\n                bscroll.finishPullUp();\r\n                //重新计算高度\r\n                nextTick(()=>{\r\n                    // 重新计算高度\r\n                    bscroll && bscroll.refresh();\r\n                })\r\n                console.log(\"contentheight:\"+document.querySelector('.content').clientHeight);\r\n                console.log(\"当前类型:\"+currentOrder.value+\",当前页：\"+page);\r\n            })\r\n        })\r\n\r\n        // 监听 任何一个变量有变量\r\n        watchEffect(()=>{\r\n            nextTick(()=>{\r\n                // 重新计算高度\r\n                bscroll && bscroll.refresh();\r\n            })\r\n        })\r\n\r\n        // 排序选项卡\r\n        const tabClick = (index) => {\r\n            const orders = ['sales', 'price', 'comments_count'];\r\n            currentOrder.value = orders[index];\r\n            getCategoryGoods(currentOrder.value, currentCid.value).then(res=>{\r\n                goods[currentOrder.value].list = res.goods.data;\r\n                nextTick(()=>{\r\n                    // 重新计算高度\r\n                    bscroll && bscroll.refresh();\r\n                })\r\n            })\r\n            // console.log(\"当前分类id: \"+currentCid.value);\r\n            // console.log(\"排序的序号：\"+currentOrder.value);\r\n        }\r\n\r\n        // 通过分类get商品\r\n        const getGoods = (cid) => {\r\n            currentCid.value = cid;\r\n            init();\r\n            // console.log(\"当前分类id: \"+currentCid.value);\r\n            // console.log(\"排序的序号：\"+currentOrder.value);\r\n        }\r\n\r\n        const bTop = ()=>{\r\n            bscroll.scrollTo(0, 100, 300);\r\n        }\r\n\r\n        return {\r\n            goods,\r\n            active,\r\n            showGoods,\r\n            activeKey,\r\n            activeName,\r\n            categories,\r\n            currentOrder,\r\n            isShowBackTop,\r\n            bTop,\r\n            getGoods,\r\n            tabClick,\r\n            itemClick:(id)=>{\r\n                console.log(id);\r\n                router.push({path:'/detail', query:{id}});\r\n            }\r\n        }\r\n    },\r\n    components: {\r\n        NavBar,\r\n        BackTop\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n#mainbox {\r\n    margin-top: 45px;\r\n    display: flex;\r\n\r\n    .ordertab {\r\n        // background-color: antiquewhite;\r\n        flex: 1;\r\n        float:right;\r\n        height:50px;\r\n        z-index: 9;\r\n        position: fixed;\r\n        top:45px;\r\n        right:0;\r\n        left:130px;\r\n    }\r\n\r\n    .leftmenu {\r\n        // background-color:cadetblue;\r\n        position: fixed;\r\n        top:95px;\r\n        left:0;\r\n        width: 130px;\r\n        height: 520px;\r\n    }\r\n\r\n    .goodslist {\r\n        // background-color: burlywood;\r\n        flex:1;\r\n        position: absolute;\r\n        top:100px;\r\n        left:130px;\r\n        right:0;\r\n        height:100vh;\r\n        padding:10px;\r\n        text-align: left !important;\r\n    }\r\n}\r\n\r\n.van-card__thumb {\r\n    width:68px !important\r\n}\r\n</style>\r\n","import {request} from './request'\r\n\r\nexport function getCategory() {\r\n    return request({\r\n        url: '/api/goods'\r\n    })\r\n}\r\n\r\nexport function getCategoryGoods(order='sales', cid =0, page=1){\r\n    return request({\r\n        url:'/api/goods?category_id='+cid+'&page='+page+'&order='+order\r\n    })\r\n}","import { render } from \"./Category.vue?vue&type=template&id=664c20eb&scoped=true\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=664c20eb&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-664c20eb\"\n\nexport default script"],"sourceRoot":""}