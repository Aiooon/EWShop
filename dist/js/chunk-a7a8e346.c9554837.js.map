{"version":3,"sources":["webpack:///./src/views/order/CreateOrder.vue?d05a","webpack:///./src/views/order/CreateOrder.vue","webpack:///./src/views/order/CreateOrder.vue?2908","webpack:///./node_modules/core-js/modules/es.function.name.js"],"names":["class","alt","default","goTo","address","name","phone","province","city","county","cartList","item","index","key","goods","cover_url","title","num","price","total","button-text","handleCreateOrder","closeable","close-on-click-overlay","show","showPay","position","style","close","border","column-num","width","height","src","aliyun","wechat","components","NavBar","setup","router","store","state","orderNo","init","loading","message","forbidClick","then","res","console","log","filter","n","is_default","length","carts","clear","push","path","params","address_id","id","dispatch","type","qr_code_url","timer","setInterval","clearInterval","query","sum","forEach","parseInt","parseFloat","render","__scopeId","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error"],"mappings":"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","file":"js/chunk-a7a8e346.c9554837.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateOrder.vue?vue&type=style&index=0&id=5e6ef33e&lang=scss&scoped=true\"","<template>\r\n    <div class=\"create-order\">\r\n        <nav-bar class=\"nav-bar\">\r\n            <template v-slot:default>\r\n                定单预览\r\n            </template>\r\n        </nav-bar>\r\n\r\n        <div class=\"address-wrap\">\r\n            <div class=\"name\" @click=\"goTo\">\r\n                <span>{{address.name}}</span>\r\n                <span>{{address.phone}}</span>\r\n            </div>\r\n            <div class=\"address\">\r\n                {{address.province}} {{address.city}} {{address.county}} {{address.address}}\r\n            </div>\r\n            <van-icon class=\"arrow\" name=\"arrow\" />\r\n        </div>\r\n        <div class=\"good\">\r\n            <div class=\"good-item\" v-for=\"(item, index) in cartList\" :key=\"index\">\r\n                <div class=\"good-img\"><img v-lazy=\"item.goods.cover_url\" alt=\"\"></div>\r\n                <div class=\"good-desc\">\r\n                    <div class=\"good-title\">\r\n                        <span>{{item.goods.title}}</span>\r\n                        <span>x{{item.num}}</span>\r\n                    </div>\r\n                    <div class=\"good-btn\">\r\n                        <div class=\"price\"><small>¥</small> {{item.goods.price+'.00'}}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <van-submit-bar\r\n                class=\"submit-all\"\r\n                :price=\"total * 100\"\r\n                button-text=\"生成订单\"\r\n                @submit=\"handleCreateOrder\"\r\n        >\r\n            商品金额\r\n        </van-submit-bar>\r\n\r\n        <van-popup\r\n                closeable\r\n                :close-on-click-overlay=\"false\"\r\n                v-model:show=\"showPay\"\r\n                position=\"bottom\"\r\n                :style=\"{ height: '40%' }\"\r\n                @close=\"close\"\r\n        >\r\n\r\n            <van-grid :border=\"false\" :column-num=\"2\">\r\n                <van-grid-item>\r\n                    支付宝二维码<br>\r\n                    <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n                </van-grid-item>\r\n                <van-grid-item>\r\n                    微信二维码<br>\r\n                    <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\r\n                </van-grid-item>\r\n\r\n            </van-grid>\r\n\r\n        </van-popup>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import { reactive, onMounted, toRefs, computed } from 'vue'\r\n    import NavBar from \"components/common/navbar/NavBar\";\r\n    import { getOrderPreview,createOrder,payOrder,payOrderStatus } from 'network/order'\r\n    import { Toast } from 'vant'\r\n    import { useRoute, useRouter } from 'vue-router'\r\n    import {useStore} from 'vuex';\r\n    export default {\r\n        name: 'CreateOrder',\r\n        components: {\r\n            NavBar\r\n        },\r\n        setup() {\r\n            const router = useRouter()\r\n            const route = useRoute()\r\n            const store = useStore()\r\n            const state = reactive({\r\n                cartList: [],\r\n                address: {},\r\n                showPay:false,\r\n                orderNo:'',\r\n                aliyun:'',\r\n                wechat:''\r\n            })\r\n\r\n            const init = ()=>{\r\n                Toast.loading({message:'加载中...', forbidClick:true});\r\n\r\n                getOrderPreview().then(res=>{\r\n                    console.log(res);\r\n                    let address = res.address.filter(n=>n.is_default == '1');\r\n\r\n                    if(address.length == 0) {\r\n                        state.address = {\r\n                            address:'还没有设置默认地址，请选择或填写地址信息'\r\n                        }\r\n                    }else{\r\n                        state.address = address[0];\r\n                    }\r\n\r\n                    state.cartList = res.carts;\r\n\r\n                    Toast.clear();\r\n\r\n                })\r\n            }\r\n\r\n            onMounted(() => {\r\n                init();\r\n            })\r\n\r\n\r\n            const goTo = () => {\r\n                router.push({ path: '/address'})\r\n            }\r\n\r\n\r\n\r\n            const handleCreateOrder = () => {\r\n                const params = {\r\n                    address_id: state.address.id\r\n                }\r\n\r\n\r\n                createOrder(params).then(res=>{\r\n                    Toast('创建定单成功');\r\n                    store.dispatch('updateCart');\r\n\r\n                    state.showPay = true;\r\n                    // 订单ID\r\n                    state.orderNo = res.id;\r\n\r\n                    payOrder(state.orderNo, {type:'aliyun'}).then(res=>{\r\n                        state.aliyun = res.qr_code_url;\r\n                        state.wechat = res.qr_code_url;\r\n                    })\r\n\r\n                    /* payOrder(state.orderNo, {type:'wechat'}).then(res=>{\r\n                        console.log(res);\r\n                        state.wechat = res.qr_code_url;\r\n                    })*/\r\n\r\n                    // 轮询查看\r\n                    const timer = setInterval(()=>{\r\n                        payOrderStatus(state.orderNo).then(res=>{\r\n                            if(res=='2') {\r\n                                clearInterval(timer);\r\n                                router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n                            }\r\n                        })\r\n                    }, 2000)\r\n                })\r\n\r\n            }\r\n\r\n            const close = () => {\r\n                router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n            }\r\n\r\n            const total = computed(()=>{\r\n                let sum = 0;\r\n                state.cartList.forEach(item=>{\r\n                    sum += parseInt(item.num) * parseFloat(item.goods.price);\r\n                })\r\n                return sum;\r\n            })\r\n\r\n            return {\r\n                ...toRefs(state),\r\n                goTo,\r\n                handleCreateOrder,\r\n                close,\r\n                total\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .create-order {\r\n        background: #f9f9f9;\r\n        .address-wrap {\r\n            text-align: left;\r\n            margin-bottom: 20px;\r\n            background: #fff;\r\n            position: relative;\r\n            margin-top: 44px;\r\n            font-size: 14px;\r\n            padding: 15px;\r\n            color: #222333;\r\n            .name, .address {\r\n                margin: 10px 0;\r\n            }\r\n            .arrow {\r\n                position: absolute;\r\n                right: 10px;\r\n                top: 50%;\r\n                transform: translateY(-50%);\r\n                font-size: 20px;\r\n            }\r\n            &::before {\r\n                position: absolute;\r\n                right: 0;\r\n                bottom: 0;\r\n                left: 0;\r\n                height: 2px;\r\n                background: -webkit-repeating-linear-gradient(135deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n                background: repeating-linear-gradient(-45deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n                background-size: 80px;\r\n                content: '';\r\n            }\r\n        }\r\n        .good {\r\n            margin-bottom: 120px;\r\n        }\r\n        .good-item {\r\n            padding: 10px;\r\n            background: #fff;\r\n            display: flex;\r\n            .good-img {\r\n                img {\r\n                    width:100px;\r\n                    height:auto;\r\n                }\r\n            }\r\n            .good-desc {\r\n                display: flex;\r\n                flex-direction: column;\r\n                justify-content: space-between;\r\n                flex: 1;\r\n                padding: 20px;\r\n                .good-title {\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                }\r\n                .good-btn {\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                    .price {\r\n                        font-size: 16px;\r\n                        color: red;\r\n                        line-height: 28px;\r\n                    }\r\n                    .van-icon-delete {\r\n                        font-size: 20px;\r\n                        margin-top: 4px;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        .pay-wrap {\r\n            position: fixed;\r\n            bottom: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            background: #fff;\r\n            padding: 10px 0;\r\n            padding-bottom: 50px;\r\n            border-top: 1px solid #e9e9e9;\r\n            >div {\r\n                display: flex;\r\n                justify-content: space-between;\r\n                padding: 0 5%;\r\n                margin: 10px 0;\r\n                font-size: 14px;\r\n                span:nth-child(2) {\r\n                    color: red;\r\n                    font-size: 18px;\r\n                }\r\n            }\r\n            .pay-btn {\r\n                position: fixed;\r\n                bottom: 7px;\r\n                right: 0;\r\n                left: 0;\r\n                width: 90%;\r\n                margin: 0 auto;\r\n            }\r\n        }\r\n    }\r\n    .submit-all {\r\n        margin-bottom: 50px;\r\n        z-index: 9 !important;\r\n    }\r\n</style>\r\n","import { render } from \"./CreateOrder.vue?vue&type=template&id=5e6ef33e&scoped=true\"\nimport script from \"./CreateOrder.vue?vue&type=script&lang=js\"\nexport * from \"./CreateOrder.vue?vue&type=script&lang=js\"\n\nimport \"./CreateOrder.vue?vue&type=style&index=0&id=5e6ef33e&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5e6ef33e\"\n\nexport default script","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n"],"sourceRoot":""}